---
output:
  knitrBootstrap::bootstrap_document:
    theme.chooser: TRUE
    highlight.chooser: TRUE
---

<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{timeSeries_timeWindow}
%\VignetteDepends{xtable}
-->

##Adding Time Window##

Constructing a window around each point to use the recent history for predictions.
<br>

```{r timeSeries_timeWindow_2_1, eval=TRUE}
simulateData2 = function(n=1000, l = 10){
	startDate = as.Date("2013-01-01")
	data.table(
		x = as.character(startDate+1:n), #
		index =	1:n, 
		temperature = sapply(1:n, function(i) i%%l * 0.1 + abs(rnorm(1))) 
	)
}
data = simulateData2()
data$target = sapply(1:n, function(i) ifelse(sum(data$temperature[(max(1, i-3):i)]) > 7, 1, 0)) #alternatively regression - time to failure
#plot(as.Date(data$x[1:30], format="%m/%d/%Y"), data$temperature[1:30])
sum(data$target)

data = addTimeWindow(data = data, dateCol = "x",dateFormat = "%Y-%m-%d", window = 10, unit = "Days", includeUntil = TRUE, relativeTime = TRUE) 
context = colsWhiteList(data, c("x","temperature"))
#plot(data$index[1:30], data$y[1:30])

```

```{r timeSeries_timeWindow_2_2, eval=TRUE, message=FALSE, results='hide', cache=TRUE}
timeWindowModel = learn(
	projectName = "ts_test", 
	trainData = colsWhiteList(data,c("last_10_Days","target")), 
	target = "target", 
	weightByClass = TRUE,
	contextDatasets = list(contextObject(data=context, name="time_info")),
	featureGenerationCtrl = featureGenerationControl(maxFeaturesCount = list(25), featureSearchMode = "ADVANCED"),
	modelBuildingCtrl = modelBuildingControl(algorithmsWhiteList = list("RRandomForestClassifier")),
	autoSave = FALSE
)
```

```{r timeSeries_timeWindow_2_3, eval=TRUE, echo=TRUE, cache=TRUE}
timeWindowModelEval = timeWindowModel$evaluate()
```

```{r timeSeries_timeWindow_2_4, eval=TRUE, results='asis'}
print(xtable(timeWindowModel$features()[1:10,c("idx","feature")]), type='html', comment=F) 
```